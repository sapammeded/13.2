<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BASELINE LIVE CHART â€” Binance WS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  html,body{margin:0;height:100%;background:#0b1220;color:#e5e7eb;font-family:system-ui}
  #top{display:flex;gap:8px;align-items:center;padding:8px;background:#020617;border-bottom:1px solid #1f2937}
  select{background:#020617;color:#e5e7eb;border:1px solid #334155;border-radius:6px;padding:4px 6px}
  #status{margin-left:auto;font-weight:700}
  #chart{height:calc(100vh - 44px)}
</style>
</head>
<body>
<div id="top">
  <b>BASELINE</b>
  <select id="pair">
    <option value="btcusdt">BTCUSDT</option>
    <option value="ethusdt">ETHUSDT</option>
    <option value="bnbusdt">BNBUSDT</option>
  </select>
  <select id="tf">
    <option value="1m">M1</option>
    <option value="5m">M5</option>
    <option value="15m">M15</option>
    <option value="30m">M30</option>
    <option value="1h">H1</option>
  </select>
  <div id="status">INIT</div>
</div>
<div id="chart"></div>

<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script>
const statusEl = document.getElementById('status');
let chart, series, ws;

function setStatus(t){ statusEl.textContent = t; }

function createChart(){
  chart = LightweightCharts.createChart(document.getElementById('chart'),{
    layout:{background:{color:'#0b1220'}, textColor:'#e5e7eb'},
    grid:{vertLines:{color:'#1f2937'}, horzLines:{color:'#1f2937'}},
    timeScale:{timeVisible:true, secondsVisible:false},
    rightPriceScale:{borderColor:'#1f2937'}
  });
  series = chart.addCandlestickSeries({
    upColor:'#22c55e', downColor:'#ef4444', borderVisible:false,
    wickUpColor:'#22c55e', wickDownColor:'#ef4444'
  });
}

function destroy(){
  if(ws){ try{ws.close();}catch(e){} ws=null; }
  if(chart){ chart.remove(); chart=null; }
}

function start(){
  destroy();
  createChart();
  setStatus('CONNECT');
  const pair = document.getElementById('pair').value;
  const tf   = document.getElementById('tf').value;
  ws = new WebSocket(`wss://stream.binance.com:9443/ws/${pair}@kline_${tf}`);
  ws.onopen = ()=> setStatus('LIVE');
  ws.onmessage = (e)=>{
    const d = JSON.parse(e.data);
    if(!d.k) return;
    const k = d.k;
    // update on every tick so chart is visibly alive
    const c = { time: Math.floor(k.t/1000), open:+k.o, high:+k.h, low:+k.l, close:+k.c };
    series.update(c);
  };
  ws.onclose = ()=> setStatus('CLOSED');
  ws.onerror = ()=> setStatus('ERROR');
}

document.getElementById('pair').onchange = start;
document.getElementById('tf').onchange   = start;

start();
</script>
</body>
</html>
